{% macro animal_form(form, is_edit=False) %}
<form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
    <div class="mb-3">
        <label for="name" class="form-label">Кличка</label>
        <input type="text" class="form-control" id="name" name="name" value="{{ form.name or '' }}" required>
        <div class="invalid-feedback">Пожалуйста, введите кличку животного</div>
    </div>

    <div class="mb-3">
        <label for="description" class="form-label">Описание</label>
        <textarea class="form-control" id="description" name="description" rows="5" required>{{ form.description or '' }}</textarea>
        <div class="invalid-feedback">Пожалуйста, введите описание животного</div>
    </div>

    <div class="mb-3">
        <label for="age_months" class="form-label">Возраст (в месяцах)</label>
        <input type="number" class="form-control" id="age_months" name="age_months" value="{{ form.age_months or '' }}" min="0" required>
        <div class="invalid-feedback">Пожалуйста, введите возраст животного</div>
    </div>

    <div class="mb-3">
        <label for="breed" class="form-label">Порода</label>
        <input type="text" class="form-control" id="breed" name="breed" value="{{ form.breed or '' }}" required>
        <div class="invalid-feedback">Пожалуйста, введите породу животного</div>
    </div>

    <div class="mb-3">
        <label for="gender" class="form-label">Пол</label>
        <select class="form-select" id="gender" name="gender" required>
            <option value="">Выберите пол</option>
            <option value="male" {% if form.gender == 'male' %}selected{% endif %}>Самец</option>
            <option value="female" {% if form.gender == 'female' %}selected{% endif %}>Самка</option>
        </select>
        <div class="invalid-feedback">Пожалуйста, выберите пол животного</div>
    </div>

    <div class="mb-3">
        <label for="status" class="form-label">Статус</label>
        <select class="form-select" id="status" name="status" required>
            <option value="">Выберите статус</option>
            <option value="available" {% if form.status == 'available' %}selected{% endif %}>Доступен</option>
            <option value="adoption" {% if form.status == 'adoption' %}selected{% endif %}>В процессе усыновления</option>
            <option value="adopted" {% if form.status == 'adopted' %}selected{% endif %}>Усыновлен</option>
        </select>
        <div class="invalid-feedback">Пожалуйста, выберите статус животного</div>
    </div>

    {% if not is_edit %}
    <div class="mb-3" id="photos-container">
        <label class="form-label">Фотографии</label>
        <div class="input-group mb-2">
            <input type="file" class="form-control" name="photos" accept="image/*" required>
            <button class="btn btn-outline-danger remove-photo-btn d-none" type="button">Удалить</button>
        </div>
    </div>
    <button type="button" class="btn btn-outline-secondary mb-3" id="add-photo-btn">
        <i class="bi bi-plus-circle"></i> Добавить ещё фото
    </button>
    {% endif %}

    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Сохранить</button>
        <a href="{{ url_for('animals.index') }}" class="btn btn-secondary">Отмена</a>
    </div>
</form>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css">
<script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js"></script>
<script>
    const easyMDE = new EasyMDE({
        element: document.getElementById('description'),
        spellChecker: false,
        status: false,
        toolbar: ['bold', 'italic', 'heading', '|', 'quote', 'unordered-list', 'ordered-list', '|', 'link', 'image', '|', 'preview'],
        placeholder: 'Введите описание животного...'
    });
</script>

<script>
    // валидация формы
    (function () {
        'use strict'
        const forms = document.querySelectorAll('.needs-validation')
        Array.from(forms).forEach(form => {
            form.addEventListener('submit', event => {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }
                form.classList.add('was-validated')
            }, false)
        })
    })()

    // добавление/удаление полей для фото
    document.addEventListener('DOMContentLoaded', function() {
        const photosContainer = document.getElementById('photos-container');
        const addPhotoBtn = document.getElementById('add-photo-btn');
        if (addPhotoBtn && photosContainer) {
            addPhotoBtn.addEventListener('click', function() {
                const group = document.createElement('div');
                group.className = 'input-group mb-2';
                group.innerHTML = `
                    <input type="file" class="form-control" name="photos" accept="image/*" required>
                    <button class="btn btn-outline-danger remove-photo-btn" type="button">Удалить</button>
                `;
                photosContainer.appendChild(group);
            });
            photosContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-photo-btn')) {
                    e.preventDefault();
                    const group = e.target.closest('.input-group');
                    if (group) group.remove();
                }
            });
        }
    });
</script>
{% endmacro %}